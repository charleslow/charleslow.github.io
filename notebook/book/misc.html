<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Miscellaneous - Chux&#x27;s Notebook</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="katex.min.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded "><a href="misc.html" class="active"><strong aria-hidden="true">1.</strong> Miscellaneous</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Recommender Systems</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="gradient_boosting.html"><strong aria-hidden="true">2.1.</strong> Gradient Boosting</a></li><li class="chapter-item expanded "><a href="tfidf.html"><strong aria-hidden="true">2.2.</strong> TF-IDF</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> Two Tower</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.4.</strong> Diversity</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.5.</strong> Exposure Bias</div></li></ol></li><li class="chapter-item expanded "><a href="papers.html"><strong aria-hidden="true">3.</strong> Papers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="schnabel_2016.html"><strong aria-hidden="true">3.1.</strong> Schnabel 2016 - Recs as Treatments</a></li><li class="chapter-item expanded "><a href="burges_2010.html"><strong aria-hidden="true">3.2.</strong> Burges 2010 - RankNET to LambdaMART</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Chux&#x27;s Notebook</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="miscellaneous-notes"><a class="header" href="#miscellaneous-notes">Miscellaneous Notes</a></h1>
<p>A collection of miscellaneous, useful notes.</p>
<h2 id="vim"><a class="header" href="#vim">Vim</a></h2>
<p>Command to interactively change each 'foo' to 'bar'. <code>:%s</code> triggers the substitute global command, followed by the search and replace phrases respectively. Finally <code>g</code> means replace all occurrences and <code>c</code> means with confirmation. Note that <code>:s</code> will only do the same for one line.</p>
<pre><code class="language-bash">:%s/foo/bar/gc
</code></pre>
<h2 id="numpy-indexing"><a class="header" href="#numpy-indexing">Numpy Indexing</a></h2>
<p>Suppose we have a 2D array <code>X</code> and would like to take a slice of certain rows and columns. We might try, for e.g., to take the first two rows of X and the 3rd/4th column of X, i.e. we expect to get a 2 by 2 matrix.</p>
<pre><code class="language-python">import numpy as np
X = np.random.randn(5, 5)
X[[0, 1], [2, 3]]
</code></pre>
<p>Unfortunately, this will return an array of items <code>array(X[0, 2], X[1, 3])</code>, which is not what we want. Instead, a slightly inefficient but clear way is to slice each axis separately. It is not optimal because the first slice creates a temporary array view before the second slice is applied.</p>
<pre><code class="language-python">X[[0, 1], :][:, [2, 3]]
</code></pre>
<p>Finally, the recommended way seems to be to use <code>np.ix_</code>. Doing <code>np.ix_([0, 1], [2, 3])</code> creates a tuple of two elements.</p>
<pre><code class="language-python">idx = np.ix_([0, 1], [2, 3])
idx
&gt;&gt; (array([[0],
           [1]]),
&gt;&gt;  array([[2, 3]]))
</code></pre>
<p>Indexing the original array with this output <code>X[idx]</code> will then give us what we want.</p>
<h2 id="asyncio"><a class="header" href="#asyncio">asyncio</a></h2>
<p><a href="https://realpython.com/async-io-python/">reference</a></p>
<p>asyncio is a single-threaded framework that does not use multi-threading or multi-processing to speed up tasks. Instead, a coordinator (or event loop) passes control from a time-consuming blocking function (e.g. time.sleep or an I/O operation) to other functions to run. This passing of control occurs with the <code>await</code> keyword. When the blocking function is completed, it notifies the coordinator and control returns to where the blocking function left off.</p>
<p><code>asyncio</code> does not speed up CPU-bound tasks, due to its single-threaded design. It only works when the function being awaited is an I/O operation that is supported by asyncio. This includes <a href="https://realpython.com/async-io-python/#libraries-that-work-with-asyncawait">stuff</a> like:</p>
<ul>
<li>HTTP (supported through <code>aiohttp</code>)</li>
<li>DB calls (e.g. <code>aioredis</code>)</li>
</ul>
<p><code>asyncio</code> is preferred for such tasks (e.g. making multiple I/O calls and doing something when they all return) over multi-processing because of its single-thread design, making it easier to debug.</p>
<h2 id="relatedness"><a class="header" href="#relatedness">relatedness</a></h2>
<p>In the context of information retrieval, Trey Grainger in <a href="https://www.manning.com/books/ai-powered-search">AI-Powered Search</a> suggests a relatedness measure to connect arbitrary entities together. Suppose we have a collection of jobs and each job is tagged with a set of skills. Suppose we wish to retrieve relevant skills to an arbitrary free text query \( q \). </p>
<p>The relatedness idea is to define a foreground of documents, e.g. based on a retrieval of documents using query \( q \) which are related to the query, and to compare the attributes of the foreground against the background, i.e. all documents. </p>
<p>Mathematically, we can think of the foreground documents as a sample, and the background documents as the population. The strength of the relationship between each skill \( t \) to the query \( q \) may then be defined as the z-statistic of the one-sample z-test of proportions of the occurrence of skill \( t \) in the foreground sample compared against the background population. A significantly greater occurrence in the sample compared to the population suggests a strong relationship between \( t \) and \( q \), and vice versa. Specifically:</p>
<p>\[
z = \frac{ \hat{p} - p }{ \sqrt{ \frac{ p(1-p) }{n} } }
\]</p>
<p>Where:</p>
<ul>
<li>\( \hat{p} = \frac{ df(q, t) }{ df(q) } \) is the sample proportion.</li>
<li>\( df(q, t) \) is the number of documents in the foreground corresponding to query \( q \) and contains skill \( t \).</li>
<li>\( df(q) \) is the total number of documents in the foreground corresponding to query \( q \). It is also the number of samples \( n \).</li>
<li>\( p = P(t) \) is the probability of skill t appearing across all documents.</li>
</ul>
<p>By performing a retrieval and ranking skills based on the z-statistic, we can compute a relationship between any arbitrary query and attribute of the documents (on the fly, if necessary). This functionality is implemented in <a href="https://solr.apache.org/guide/8_5/json-facet-api.html#relatedness-and-semantic-knowledge-graphs">solr</a>.</p>
<h2 id="package-versioning"><a class="header" href="#package-versioning">Package Versioning</a></h2>
<p><a href="https://python-poetry.org/docs/dependency-specification/">link</a></p>
<p><a href="https://semver.org/">SemVer</a> is the versioning standard for Python packages. For a package version of e.g. <code>1.2.3</code>:</p>
<ul>
<li>The first number <code>1</code> is the major version. We update it when we make major API changes. A major of <code>0</code> indicates that the package is under initial development and anything may change.</li>
<li>The second number <code>2</code> is the minor version. We update it when we add functionality in a backward compatible manner.</li>
<li>The third number <code>3</code> is the patch version. We update it when we patch bugs in a backward compatible manner.</li>
</ul>
<p>Poetry is a useful tool to manage package dependencies in a Python library. In the <code>pyproject.toml</code> file, we specify package dependencies in the following manner:</p>
<pre><code>[tool.poetry.dependencies]
python = &quot;&gt;=3.8,&lt;3.11&quot;
requests = &quot;^2.26.0&quot;
pytz = &quot;~2022.1&quot;
</code></pre>
<p>The <code>caret</code> requirement (e.g. <code>requests = &quot;^2.26.0&quot;</code>) means that SemVer compatible changes are allowed, i.e. an update is allowed if the version number does not modify the left-most non-zero digit. E.g.:</p>
<ul>
<li><code>^1.2.3</code> means that <code>1.3.0</code> is allowed but not <code>2.0.0</code></li>
<li><code>^0.2.4</code> means that <code>0.2.5</code> is allowed but not <code>0.3.0</code></li>
</ul>
<p>The <code>tilde</code> requirement is somewhat stricter. It specifies a minimal version but allows room to upgrade depending on how many digits are supplied. If <code>major.minor.patch</code> or <code>major.minor</code> is supplied, only patch-level changes are allowed. If <code>major</code> is supplied, minor and patch level changes are allowed.</p>
<ul>
<li><code>~1.2.3</code> means that <code>1.2.7</code> is allowed but not <code>1.3.0</code></li>
<li><code>~1.2</code> means that <code>1.2.7</code> is allowed but not <code>1.3.0</code></li>
<li><code>~1</code> means that <code>1.3.0</code> is allowed but not <code>2.0.0</code></li>
</ul>
<p>The poetry versioning specification depends on developer updating the library versions in a disciplined way. It allows us to provide some flexibility in package versioning while avoiding updating a dependent package to a version that breaks our code. Having more flexibility in specifying package dependencies reduces the risk of dependencies version conflicting.</p>
<h2 id="parallelism-in-python"><a class="header" href="#parallelism-in-python">Parallelism in Python</a></h2>
<p>References: <a href="https://realpython.com/python-gil/">realpython</a>, <a href="https://superfastpython.com/numpy-vs-gil/">superfastpython</a></p>
<p>The Python Global Interpreter Lock (GIL) is a lock that allows only one thread to run at a time. The reason for this design feature in Python is because the Python interpreter is not thread-safe, meaning that if the GIL did not exist, the Python interpreter could introduce race conditions and other fatal errors due to multiple threads modifying memory at the same time. The GIL also allowed other non-thread-safe C programs to be easily integrated into the Python ecosystem, which contributed to Python's success as a language.</p>
<p>The GIL also improves performance for single-threaded programs, as it only requires a single lock to be managed (not sure how this works). There have been attempts to remove the GIL from Python but none have been successful because they would degrade single-threaded performance.</p>
<p>For many C extensions (e.g. numpy), multi-threading is still possible because these extensions are allowed to manually release the GIL (as long as they restore things back to normal when the functions return). This allows us to still use multi-threading for CPU-intensive functions with the GIL around. Similarly for Rust, we can release the GIL to achieve <a href="https://pyo3.rs/v0.9.2/parallelism">parallelism</a>.</p>
<p>Alternatively, we can use <code>multiprocessing</code> to create multiple processes (instead of threads). Each process contains its own Python interpreter (and GIL) and hence can run truly in parallel. The downside is that the overhead of creating and managing processes is much more than that for threads, meaning that the benefits of multiprocessing are much dampened compared to multi-threading.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="gradient_boosting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="gradient_boosting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
